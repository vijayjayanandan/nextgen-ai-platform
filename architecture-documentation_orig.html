<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastAPI + Next.js AI Platform - Interactive Architecture Documentation</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .nav-tab {
            padding: 12px 24px;
            background: #f8f9fa;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .nav-tab.active {
            background: #007bff;
            color: white;
        }

        .content-section {
            display: none;
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .content-section.active {
            display: block;
        }

        .layer-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .layer-btn {
            padding: 8px 16px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .layer-btn:hover {
            background: #5a6268;
        }

        .layer-btn.active {
            background: #28a745;
        }

        .diagram-container {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .component-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .component-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .component-card.pii {
            border-left: 4px solid #dc3545;
        }

        .component-card.rag {
            border-left: 4px solid #007bff;
        }

        .component-card.auth {
            border-left: 4px solid #28a745;
        }

        .component-card.database {
            border-left: 4px solid #6f42c1;
        }

        .component-card.api {
            border-left: 4px solid #fd7e14;
        }

        .component-card.config {
            border-left: 4px solid #6c757d;
        }

        .component-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #495057;
        }

        .component-description {
            color: #6c757d;
            margin-bottom: 15px;
        }

        .component-details {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }

        .component-details.expanded {
            display: block;
        }

        .file-list {
            list-style: none;
            margin: 10px 0;
        }

        .file-list li {
            padding: 5px 0;
            color: #007bff;
            cursor: pointer;
        }

        .file-list li:hover {
            text-decoration: underline;
        }

        .search-container {
            margin-bottom: 2rem;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px;
            border: 1px solid #dee2e6;
            border-radius: 25px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            border-color: #007bff;
        }

        .breadcrumb {
            background: #e9ecef;
            padding: 10px 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: #007bff;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .metric-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
        }

        .metric-label {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-implemented {
            background-color: #28a745;
        }

        .status-missing {
            background-color: #dc3545;
        }

        .status-partial {
            background-color: #ffc107;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tab {
                margin-right: 0;
                margin-bottom: 5px;
            }

            .component-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ FastAPI + Next.js AI Platform</h1>
            <p>Interactive Architecture Documentation - Enterprise-Grade AI Platform for Canadian Organizations</p>
            <p><strong>Features:</strong> Two-Tier PII Detection ‚Ä¢ RAG Pipeline ‚Ä¢ PIPEDA Compliance ‚Ä¢ Vector Databases</p>
        </div>

        <div class="search-container">
            <input type="text" class="search-input" placeholder="üîç Search components, services, files..." id="searchInput">
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showSection('overview')">üìä System Overview</button>
            <button class="nav-tab" onclick="showSection('architecture')">üèóÔ∏è Architecture Layers</button>
            <button class="nav-tab" onclick="showSection('services')">‚öôÔ∏è Services</button>
            <button class="nav-tab" onclick="showSection('pii')">üîí PII Detection</button>
            <button class="nav-tab" onclick="showSection('rag')">üß† RAG Pipeline</button>
            <button class="nav-tab" onclick="showSection('database')">üóÑÔ∏è Database</button>
            <button class="nav-tab" onclick="showSection('api')">üåê API Endpoints</button>
            <button class="nav-tab" onclick="showSection('maintenance')">üîß Maintenance</button>
            <button class="nav-tab" onclick="showSection('onboarding')">üéì Onboarding</button>
        </div>

        <!-- System Overview Section -->
        <div id="overview" class="content-section active">
            <div class="breadcrumb">
                <a href="#overview">Home</a> > System Overview
            </div>
            
            <h2>üéØ System Overview</h2>
            <p>Enterprise-grade AI platform featuring advanced PII detection, RAG capabilities, and PIPEDA compliance for Canadian organizations.</p>

            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value">47</div>
                    <div class="metric-label">Total Services</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">12</div>
                    <div class="metric-label">API Endpoints</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">6</div>
                    <div class="metric-label">Database Models</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">2</div>
                    <div class="metric-label">PII Tiers</div>
                </div>
            </div>

            <div class="diagram-container">
                <div class="mermaid">
                    graph TB
                        subgraph "Frontend Layer"
                            NextJS[Next.js Frontend<br/>React Components]
                            UI[UI Components<br/>Chat, Documents, Settings]
                        end
                        
                        subgraph "API Gateway"
                            FastAPI[FastAPI Backend<br/>Python 3.11+]
                            Router[API Router<br/>v1 Endpoints]
                        end
                        
                        subgraph "AI Services Layer"
                            Orchestrator[HybridOrchestrator<br/>Two-Tier PII Architecture]
                            PII1[FastPIIScreener<br/>Tier 1: 0-5ms]
                            PII2[BackgroundProcessor<br/>Tier 2: Comprehensive]
                            RAG[RAG Pipeline<br/>Vector Search + Attribution]
                        end
                        
                        subgraph "Data Layer"
                            PostgreSQL[(PostgreSQL<br/>Primary Database)]
                            VectorDB[(Vector Database<br/>Pinecone/Weaviate)]
                            Redis[(Redis<br/>Caching)]
                        end
                        
                        subgraph "External Services"
                            OpenAI[OpenAI API<br/>GPT Models]
                            OnPrem[On-Premises<br/>Local Models]
                        end
                        
                        NextJS --> FastAPI
                        FastAPI --> Router
                        Router --> Orchestrator
                        Orchestrator --> PII1
                        Orchestrator --> PII2
                        Orchestrator --> RAG
                        RAG --> VectorDB
                        Orchestrator --> PostgreSQL
                        PII1 --> Redis
                        Orchestrator --> OpenAI
                        Orchestrator --> OnPrem
                        
                        classDef frontend fill:#e1f5fe
                        classDef api fill:#fff3e0
                        classDef ai fill:#f3e5f5
                        classDef data fill:#e8f5e8
                        classDef external fill:#fce4ec
                        
                        class NextJS,UI frontend
                        class FastAPI,Router api
                        class Orchestrator,PII1,PII2,RAG ai
                        class PostgreSQL,VectorDB,Redis data
                        class OpenAI,OnPrem external
                </div>
            </div>

            <div class="component-grid">
                <div class="component-card pii" onclick="toggleDetails(this)">
                    <div class="component-title">
                        <span class="status-indicator status-implemented"></span>
                        üîí Two-Tier PII Detection
                    </div>
                    <div class="component-description">
                        Enterprise-grade PII filtering with 0-5ms fast screening and comprehensive background analysis.
                    </div>
                    <div class="component-details">
                        <strong>Key Files:</strong>
                        <ul class="file-list">
                            <li onclick="showFileDetails('app/services/pii/fast_pii_screener.py')">fast_pii_screener.py</li>
                            <li onclick="showFileDetails('app/services/pii/background_processor.py')">background_processor.py</li>
                            <li onclick="showFileDetails('app/services/hybrid_orchestrator.py')">hybrid_orchestrator.py</li>
                        </ul>
                        <strong>Performance:</strong> Tier 1: 0-5ms, Tier 2: Async processing<br>
                        <strong>Compliance:</strong> PIPEDA compliant with audit logging
                    </div>
                </div>

                <div class="component-card rag" onclick="toggleDetails(this)">
                    <div class="component-title">
                        <span class="status-indicator status-implemented"></span>
                        üß† RAG Pipeline
                    </div>
                    <div class="component-description">
                        Complete Retrieval Augmented Generation with vector databases and attribution.
                    </div>
                    <div class="component-details">
                        <strong>Key Files:</strong>
                        <ul class="file-list">
                            <li onclick="showFileDetails('app/services/retrieval/vector_db_service.py')">vector_db_service.py</li>
                            <li onclick="showFileDetails('app/services/embeddings/embedding_service.py')">embedding_service.py</li>
                            <li onclick="showFileDetails('app/services/explanation/attribution_service.py')">attribution_service.py</li>
                        </ul>
                        <strong>Vector DBs:</strong> Pinecone, Weaviate<br>
                        <strong>Features:</strong> Semantic search, attribution, citations
                    </div>
                </div>

                <div class="component-card auth" onclick="toggleDetails(this)">
                    <div class="component-title">
                        <span class="status-indicator status-implemented"></span>
                        üîê Authentication & Security
                    </div>
                    <div class="component-description">
                        JWT-based authentication with role-based access control and security middleware.
                    </div>
                    <div class="component-details">
                        <strong>Key Files:</strong>
                        <ul class="file-list">
                            <li onclick="showFileDetails('app/core/security.py')">security.py</li>
                            <li onclick="showFileDetails('app/core/middleware.py')">middleware.py</li>
                            <li onclick="showFileDetails('app/api/v1/endpoints/auth.py')">auth.py</li>
                        </ul>
                        <strong>Features:</strong> JWT tokens, RBAC, CORS, security headers
                    </div>
                </div>

                <div class="component-card database" onclick="toggleDetails(this)">
                    <div class="component-title">
                        <span class="status-indicator status-partial"></span>
                        üóÑÔ∏è Database Layer
                    </div>
                    <div class="component-description">
                        PostgreSQL with async SQLAlchemy, UUID primary keys, and comprehensive models.
                    </div>
                    <div class="component-details">
                        <strong>Key Files:</strong>
                        <ul class="file-list">
                            <li onclick="showFileDetails('app/db/session.py')">session.py</li>
                            <li onclick="showFileDetails('app/db/base.py')">base.py</li>
                            <li onclick="showFileDetails('app/models/')">models/ (various)</li>
                        </ul>
                        <strong>Status:</strong> Some models missing (user.py, chat.py, model.py, audit.py)
                    </div>
                </div>

                <div class="component-card api" onclick="toggleDetails(this)">
                    <div class="component-title">
                        <span class="status-indicator status-implemented"></span>
                        üåê API Endpoints
                    </div>
                    <div class="component-description">
                        RESTful API with FastAPI, automatic OpenAPI docs, and comprehensive endpoints.
                    </div>
                    <div class="component-details">
                        <strong>Key Files:</strong>
                        <ul class="file-list">
                            <li onclick="showFileDetails('app/api/v1/router.py')">router.py</li>
                            <li onclick="showFileDetails('app/api/v1/endpoints/')">endpoints/ (various)</li>
                        </ul>
                        <strong>Endpoints:</strong> Chat, Completions, Documents, Retrieval, PII Monitoring
                    </div>
                </div>

                <div class="component-card config" onclick="toggleDetails(this)">
                    <div class="component-title">
                        <span class="status-indicator status-implemented"></span>
                        ‚öôÔ∏è Configuration
                    </div>
                    <div class="component-description">
                        Comprehensive configuration management with environment variables and feature flags.
                    </div>
                    <div class="component-details">
                        <strong>Key Files:</strong>
                        <ul class="file-list">
                            <li onclick="showFileDetails('app/core/config.py')">config.py</li>
                            <li onclick="showFileDetails('.env.example')">.env.example</li>
                        </ul>
                        <strong>Features:</strong> PIPEDA compliance, feature flags, multi-environment support
                    </div>
                </div>
            </div>
        </div>

        <!-- Architecture Layers Section -->
        <div id="architecture" class="content-section">
            <div class="breadcrumb">
                <a href="#overview">Home</a> > Architecture Layers
            </div>
            
            <h2>üèóÔ∏è Architecture Layers</h2>
            <p>Progressive detail views from executive overview to implementation specifics.</p>

            <div class="layer-selector">
                <button class="layer-btn active" onclick="showLayer('layer1')">Layer 1: Executive</button>
                <button class="layer-btn" onclick="showLayer('layer2')">Layer 2: Services</button>
                <button class="layer-btn" onclick="showLayer('layer3')">Layer 3: Modules</button>
                <button class="layer-btn" onclick="showLayer('layer4')">Layer 4: Functions</button>
            </div>

            <div id="layer1" class="diagram-container">
                <h3>Layer 1: Executive Overview</h3>
                <div class="mermaid">
                    graph LR
                        Users[üë• Users] --> Frontend[üñ•Ô∏è Next.js Frontend]
                        Frontend --> API[üöÄ FastAPI Backend]
                        API --> AI[üß† AI Services]
                        AI --> Data[üóÑÔ∏è Data Layer]
                        AI --> External[üåê External APIs]
                        
                        classDef users fill:#e8f5e8
                        classDef frontend fill:#e1f5fe
                        classDef api fill:#fff3e0
                        classDef ai fill:#f3e5f5
                        classDef data fill:#e8f5e8
                        classDef external fill:#fce4ec
                        
                        class Users users
                        class Frontend frontend
                        class API api
                        class AI ai
                        class Data data
                        class External external
                </div>
            </div>

            <div id="layer2" class="diagram-container" style="display:none;">
                <h3>Layer 2: Service Architecture</h3>
                <div class="mermaid">
                    graph TB
                        subgraph "Frontend Services"
                            NextJS[Next.js App]
                            Components[React Components]
                            API_Client[API Client]
                        end
                        
                        subgraph "Backend Services"
                            FastAPI[FastAPI Server]
                            Router[API Router]
                            Middleware[Security Middleware]
                        end
                        
                        subgraph "AI Processing"
                            Orchestrator[HybridOrchestrator]
                            FastPII[FastPIIScreener]
                            BackgroundPII[BackgroundProcessor]
                            RAGService[RAG Service]
                            ModelRouter[Model Router]
                        end
                        
                        subgraph "Data Services"
                            PostgreSQL[(PostgreSQL)]
                            VectorDB[(Vector DB)]
                            Redis[(Redis Cache)]
                        end
                        
                        NextJS --> FastAPI
                        FastAPI --> Router
                        Router --> Orchestrator
                        Orchestrator --> FastPII
                        Orchestrator --> BackgroundPII
                        Orchestrator --> RAGService
                        Orchestrator --> ModelRouter
                        RAGService --> VectorDB
                        FastPII --> Redis
                        Orchestrator --> PostgreSQL
                </div>
            </div>

            <div id="layer3" class="diagram-container" style="display:none;">
                <h3>Layer 3: Module Implementation</h3>
                <div class="mermaid">
                    graph TB
                        subgraph "PII Detection Modules"
                            FastScreener[FastPIIScreener<br/>- pattern_matching<br/>- circuit_breaker<br/>- cache_manager]
                            BackgroundProc[BackgroundProcessor<br/>- ml_analysis<br/>- audit_logger<br/>- queue_manager]
                            ContentFilter[EnterpriseContentFilter<br/>- comprehensive_scan<br/>- compliance_check]
                        end
                        
                        subgraph "RAG Modules"
                            VectorService[VectorDBService<br/>- pinecone_client<br/>- weaviate_client<br/>- search_engine]
                            EmbeddingService[EmbeddingService<br/>- openai_embeddings<br/>- semantic_search<br/>- batch_processing]
                            Attribution[AttributionService<br/>- citation_generator<br/>- source_tracker]
                        end
                        
                        subgraph "Core Modules"
                            Config[Configuration<br/>- settings_manager<br/>- feature_flags<br/>- env_validation]
                            Security[Security<br/>- jwt_handler<br/>- rbac_manager<br/>- encryption]
                            Database[Database<br/>- session_manager<br/>- model_registry<br/>- migration_handler]
                        end
                </div>
            </div>

            <div id="layer4" class="diagram-container" style="display:none;">
                <h3>Layer 4: Function-Level Flow</h3>
                <div class="mermaid">
                    sequenceDiagram
                        participant User
                        participant Frontend
                        participant API
                        participant Orchestrator
                        participant FastPII
                        participant BackgroundPII
                        participant RAG
                        participant LLM
                        
                        User->>Frontend: Submit message
                        Frontend->>API: POST /chat/completions
                        API->>Orchestrator: process_chat_completion()
                        Orchestrator->>FastPII: safe_quick_pii_check()
                        FastPII-->>Orchestrator: FastPIIResult
                        
                        alt PII Detected
                            Orchestrator-->>API: Block with error
                            API-->>Frontend: Content filtered
                        else PII Clear
                            Orchestrator->>BackgroundPII: submit_for_analysis()
                            Orchestrator->>RAG: semantic_search()
                            RAG-->>Orchestrator: source_chunks
                            Orchestrator->>LLM: generate_completion()
                            LLM-->>Orchestrator: completion
                            Orchestrator-->>API: ChatCompletionResponse
                            API-->>Frontend: Response with citations
                        end
                </div>
            </div>
        </div>

        <!-- Services Section -->
        <div id="services" class="content-section">
            <div class="breadcrumb">
                <a href="#overview">Home</a> > Services
            </div>
            
            <h2>‚öôÔ∏è Services Overview</h2>
            <p>Detailed breakdown of all services in the platform.</p>

            <div class="component-grid">
                <div class="component-card pii">
                    <div class="component-title">üîí PII Services</div>
                    <div class="component-description">Two-tier PII detection architecture</div>
                    <ul class="file-list">
                        <li>FastPIIScreener - Immediate blocking (0-5ms)</li>
                        <li>BackgroundProcessor - Comprehensive analysis</li>
                        <li>EnterpriseContentFilter - ML-based detection</li>
                    </ul>
                </div>

                <div class="component-card rag">
                    <div class="component-title">üß† RAG Services</div>
                    <div class="component-description">Retrieval Augmented Generation pipeline</div>
                    <ul class="file-list">
                        <li>VectorDBService - Pinecone/Weaviate integration</li>
                        <li>EmbeddingService - OpenAI embeddings</li>
                        <li>AttributionService - Citation generation</li>
                        <li>DocumentProcessor - Text chunking</li>
                    </ul>
                </div>

                <div class="component-card api">
                    <div class="component-title">üåê LLM Services</div>
                    <div class="component-description">Language model integrations</div>
                    <ul class="file-list">
                        <li>OpenAIService - GPT models</li>
                        <li>AnthropicService - Claude models</li>
                        <li>OnPremService - Local models</li>
                        <li>ModelRouter - Request routing</li>
                    </ul>
                </div>

                <div class="component-card database">
                    <div class="component-title">üóÑÔ∏è Data Services</div>
                    <div class="component-description">Database and storage services</div>
                    <ul class="file-list">
                        <li>SessionManager - Database connections</li>
                        <li>Repositories - Data access layer</li>
                        <li>Models - SQLAlchemy entities</li>
                        <li>Schemas - Pydantic validation</li>
                    </ul>
                </div>

                <div class="component-card auth">
                    <div class="component-title">üîê Security Services</div>
                    <div class="component-description">Authentication and authorization</div>
                    <ul class="file-list">
                        <li>JWTHandler - Token management</li>
                        <li>RBACManager - Role-based access</li>
                        <li>SecurityMiddleware - Request filtering</li>
                        <li>EncryptionService - Data protection</li>
                    </ul>
                </div>

                <div class="component-card config">
                    <div class="component-title">‚öôÔ∏è Core Services</div>
                    <div class="component-description">Configuration and utilities</div>
                    <ul class="file-list">
                        <li>ConfigManager - Settings management</li>
                        <li>LoggingService - Structured logging</li>
                        <li>TelemetryService - Monitoring</li>
                        <li>HelperUtilities - Common functions</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- PII Detection Section -->
        <div id="pii" class="content-section">
            <div class="breadcrumb">
                <a href="#overview">Home</a> > PII Detection
            </div>
            
            <h2>üîí Two-Tier PII Detection Architecture</h2>
            <p>Enterprise-grade PII filtering with optimal performance and comprehensive security.</p>

            <div class="diagram-container">
                <div class="mermaid">
                    flowchart TD
                        Input[User Input] --> FastScreener[FastPIIScreener<br/>Tier 1: 0-5ms]
                        
                        FastScreener --> Critical{Critical PII<br/>Detected?}
                        
                        Critical -->|Yes| Block[üö´ Block Request<br/>Return Error]
                        Critical -->|No| Process[‚úÖ Continue Processing]
                        
                        FastScreener --> Background[BackgroundProcessor<br/>Tier 2: Comprehensive]
                        
                        Background --> MLAnalysis[ML-Based Analysis]
                        Background --> ComplianceCheck[PIPEDA Compliance Check]
                        Background --> AuditLog[Audit Logging]
                        
                        Process --> LLM[Language Model Processing]
                        
                        MLAnalysis --> Report[Generate Report]
                        ComplianceCheck --> Report
                        AuditLog --> Report
                        
                        classDef input fill:#e1f5fe
                        classDef tier1 fill:#fff3e0
                        classDef tier2 fill:#f3e5f5
                        classDef decision fill:#fce4ec
                        classDef action fill:#e8f5e8
                        classDef block fill:#ffebee
                        
                        class Input input
                        class FastScreener tier1
                        class Background,MLAnalysis,ComplianceCheck,AuditLog tier2
                        class Critical decision
                        class Process,LLM action
                        class Block block
                </div>
            </div>

            <div class="component-grid">
                <div class="component-card pii">
                    <div class="component-title">‚ö° Tier 1: FastPIIScreener</div>
                    <div class="component-description">Ultra-fast critical PII detection (0-5ms)</div>
                    <ul class="file-list">
                        <li><strong>Pattern Matching:</strong> SIN, UCI, IRCC numbers</li>
                        <li><strong>Circuit Breaker:</strong> Fail-safe protection</li>
                        <li><strong>Redis Cache:</strong> Performance optimization</li>
                        <li><strong>Anonymization:</strong> Real-time tokenization</li>
                    </ul>
                </div>

                <div class="component-card pii">
                    <div class="component-title">üîç Tier 2: BackgroundProcessor</div>
                    <div class="component-description">Comprehensive ML-based analysis</div>
                    <ul class="file-list">
                        <li><strong>ML Models:</strong> Advanced PII detection</li>
                        <li><strong>PIPEDA Compliance:</strong> Canadian privacy law</li>
                        <li><strong>Audit Logging:</strong> Complete trail</li>
                        <li><strong>Queue Management:</strong> Async processing</li>
                    </ul>
                </div>

                <div class="component-card pii">
                    <div class="component-title">üõ°Ô∏è EnterpriseContentFilter</div>
                    <div class="component-description">Enterprise-grade content filtering</div>
                    <ul class="file-list">
                        <li><strong>Multi-Model:</strong> Ensemble detection</li>
                        <li><strong>Context Aware:</strong> Semantic understanding</li>
                        <li><strong>Configurable:</strong> Risk thresholds</li>
                        <li><strong>Reversible:</strong> Tokenization support</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- RAG Pipeline Section -->
        <div id="rag" class="content-section">
            <div class="breadcrumb">
                <a href="#overview">Home</a> > RAG Pipeline
            </div>
            
            <h2>üß† RAG Pipeline Architecture</h2>
            <p>Complete Retrieval Augmented Generation with vector databases and attribution.</p>

            <div class="diagram-container">
                <div class="mermaid">
                    flowchart TD
                        Document[üìÑ Document Upload] --> Chunking[üìù Text Chunking]
                        Chunking --> Embedding[üî¢ Generate Embeddings]
                        Embedding --> VectorStore[üóÑÔ∏è Vector Database Storage]
                        
                        Query[‚ùì User Query] --> QueryEmbedding[üî¢ Query Embedding]
                        QueryEmbedding --> Search[üîç Semantic Search]
                        VectorStore --> Search
                        
                        Search --> Retrieval[üìã Retrieve Top-K Chunks]
                        Retrieval --> Context[üìñ Build Context]
                        Context --> LLM[ü§ñ LLM Generation]
                        
                        LLM --> Attribution[üìö Add Citations]
                        Attribution --> Response[‚úÖ Final Response]
                        
                        classDef document fill:#e1f5fe
                        classDef processing fill:#fff3e0
                        classDef storage fill:#f3e5f5
                        classDef query fill:#e8f5e8
                        classDef generation fill:#fce4ec
                        
                        class Document,Chunking document
                        class Embedding,QueryEmbedding processing
                        class VectorStore,Search storage
                        class Query,Retrieval,Context query
                        class LLM,Attribution,Response generation
                </div>
            </div>

            <div class="component-grid">
                <div class="component-card rag">
                    <div class="component-title">üìÑ Document Processing</div>
                    <div class="component-description">Text extraction and chunking</div>
                    <ul class="file-list">
                        <li><strong>File Types:</strong> PDF, DOCX, TXT, HTML</li>
                        <li><strong>Chunking:</strong> Semantic and fixed-size</li>
                        <li><strong>Metadata:</strong> Source tracking</li>
                        <li><strong>Deduplication:</strong> Content hashing</li>
                    </ul>
                </div>

                <div class="component-card rag">
                    <div class="component-title">üî¢ Embedding Service</div>
                    <div class="component-description">Vector generation and management</div>
                    <ul class="file-list">
                        <li><strong>Models:</strong> OpenAI text-embedding-ada-002</li>
                        <li><strong>Batch Processing:</strong> Efficient generation</li>
                        <li><strong>Caching:</strong> Avoid regeneration</li>
                        <li><strong>Versioning:</strong> Model updates</li>
                    </ul>
                </div>

                <div class="component-card rag">
                    <div class="component-title">üóÑÔ∏è Vector Database</div>
                    <div class="component-description">High-performance vector storage</div>
                    <ul class="file-list">
                        <li><strong>Pinecone:</strong> Managed vector DB</li>
                        <li><strong>Weaviate:</strong> Open-source option</li>
                        <li><strong>Hybrid Search:</strong> Vector + keyword</li>
                        <li><strong>Filtering:</strong> Metadata-based</li>
                    </ul>
                </div>

                <div class="component-card rag">
                    <div class="component-title">üìö Attribution Service</div>
                    <div class="component-description">Citation and source tracking</div>
                    <ul class="file-list">
                        <li><strong>Citations:</strong> Automatic footnotes</li>
                        <li><strong>Source Tracking:</strong> Document lineage</li>
                        <li><strong>Phrase Matching:</strong> Exact attribution</li>
                        <li><strong>Compliance:</strong> Audit requirements</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Database Section -->
        <div id="database" class="content-section">
            <div class="breadcrumb">
                <a href="#overview">Home</a> > Database
            </div>
            
            <h2>üóÑÔ∏è Database Architecture</h2>
            <p>PostgreSQL with async SQLAlchemy and comprehensive data models.</p>

            <div class="diagram-container">
                <div class="mermaid">
                    erDiagram
                        Document {
                            uuid id PK
                            string title
                            text description
                            enum source_type
                            string source_id
                            string content_type
                            string language
                            jsonb meta_data
                            enum status
                            boolean is_public
                            string security_classification
                            jsonb allowed_roles
                            string content_hash
                            string storage_path
                            timestamp created_at
                            timestamp updated_at
                        }
                        
                        DocumentChunk {
                            uuid id PK
                            uuid document_id FK
                            text content
                            integer chunk_index
                            jsonb meta_data
                            integer page_number
                            string section_title
                            timestamp created_at
                            timestamp updated_at
                        }
                        
                        Embedding {
                            uuid id PK
                            uuid chunk_id FK
                            string model_name
                            string model_version
                            integer dimensions
                            float_array vector
                            string vector_db_id
                            timestamp created_at
                            timestamp updated_at
                        }
                        
                        User {
                            uuid id PK
                            string email
                            string username
                            string hashed_password
                            jsonb roles
                            boolean is_active
                            timestamp last_login
                            timestamp created_at
                            timestamp updated_at
                        }
                        
                        Conversation {
                            uuid id PK
                            uuid user_id FK
                            string title
                            jsonb metadata
                            timestamp created_at
                            timestamp updated_at
                        }
                        
                        Message {
                            uuid id PK
                            uuid conversation_id FK
                            enum role
                            text content
                            jsonb metadata
                            timestamp created_at
                        }
                        
                        Document ||--o{ DocumentChunk : contains
                        DocumentChunk ||--o{ Embedding : has
                        User ||--o{ Conversation : creates
                        Conversation ||--o{ Message : contains
                </div>
            </div>

            <div class="component-grid">
                <div class="component-card database">
                    <div class="component-title">
                        <span class="status-indicator status-implemented"></span>
                        üìÑ Document Models
                    </div>
                    <div class="component-description">Document and chunk management</div>
                    <ul class="file-list">
                        <li><strong>Document:</strong> Source documents with metadata</li>
                        <li><strong>DocumentChunk:</strong> Text chunks for RAG</li>
                        <li><strong>Security:</strong> Classification and RBAC</li>
                        <li><strong>Versioning:</strong> Content hash tracking</li>
                    </ul>
                </div>

                <div class="component-card database">
                    <div class="component-title">
                        <span class="status-indicator status-implemented"></span>
                        üî¢ Embedding Models
                    </div>
                    <div class="component-description">Vector storage and management</div>
                    <ul class="file-list">
                        <li><strong>Embedding:</strong> Vector representations</li>
                        <li><strong>Model Tracking:</strong> Version management</li>
                        <li><strong>External IDs:</strong> Vector DB references</li>
                        <li><strong>Performance:</strong> Indexed lookups</li>
                    </ul>
                </div>

                <div class="component-card database">
                    <div class="component-title">
                        <span class="status-indicator status-missing"></span>
                        üë§ User Models
                    </div>
                    <div class="component-description">Authentication and user management</div>
                    <ul class="file-list">
                        <li><strong>Status:</strong> ‚ùå Missing implementation</li>
                        <li><strong>Required:</strong> User, roles, permissions</li>
                        <li><strong>Features:</strong> JWT auth, RBAC</li>
                        <li><strong>Security:</strong> Password hashing</li>
                    </ul>
                </div>

                <div class="component-card database">
                    <div class="component-title">
                        <span class="status-indicator status-missing"></span>
                        üí¨ Chat Models
                    </div>
                    <div class="component-description">Conversation and message storage</div>
                    <ul class="file-list">
                        <li><strong>Status:</strong> ‚ùå Missing implementation</li>
                        <li><strong>Required:</strong> Conversation, Message</li>
                        <li><strong>Features:</strong> Chat history, metadata</li>
                        <li><strong>Performance:</strong> Efficient queries</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- API Endpoints Section -->
        <div id="api" class="content-section">
            <div class="breadcrumb">
                <a href="#overview">Home</a> > API Endpoints
            </div>
            
            <h2>üåê API Endpoints</h2>
            <p>RESTful API with FastAPI, automatic OpenAPI docs, and comprehensive endpoints.</p>

            <div class="diagram-container">
                <div class="mermaid">
                    graph TD
                        API[FastAPI Application] --> Router[API Router v1]
                        
                        Router --> Auth[üîê /auth]
                        Router --> Chat[üí¨ /chat]
                        Router --> Completions[ü§ñ /completions]
                        Router --> Documents[üìÑ /documents]
                        Router --> Retrieval[üîç /retrieval]
                        Router --> Moderation[üõ°Ô∏è /moderation]
                        Router --> Models[üß† /models]
                        Router --> Users[üë§ /users]
                        Router --> Monitoring[üìä /monitoring]
                        
                        Auth --> Login[POST /login]
                        Auth --> Refresh[POST /refresh]
                        Auth --> Logout[POST /logout]
                        
                        Chat --> ChatCompletion[POST /completions]
                        Chat --> ChatHistory[GET /history]
                        
                        Completions --> TextCompletion[POST /]
                        Completions --> StreamCompletion[POST /stream]
                        
                        Documents --> Upload[POST /upload]
                        Documents --> List[GET /]
                        Documents --> Delete[DELETE /{id}]
                        
                        Retrieval --> Search[POST /search]
                        Retrieval --> Similarity[POST /similarity]
                        
                        Moderation --> Screen[POST /screen]
                        Moderation --> Analyze[POST /analyze]
                        
                        Models --> ListModels[GET /]
                        Models --> ModelInfo[GET /{model}]
                        
                        Users --> CreateUser[POST /]
                        Users --> GetUser[GET /{id}]
                        Users --> UpdateUser[PUT /{id}]
                        
                        Monitoring --> PIIStats[GET /pii/stats]
                        Monitoring --> Performance[GET /performance]
                </div>
            </div>

            <div class="component-grid">
                <div class="component-card api">
                    <div class="component-title">üîê Authentication Endpoints</div>
                    <div class="component-description">JWT-based authentication</div>
                    <ul class="file-list">
                        <li><strong>POST /auth/login:</strong> User authentication</li>
                        <li><strong>POST /auth/refresh:</strong> Token refresh</li>
                        <li><strong>POST /auth/logout:</strong> Session termination</li>
                        <li><strong>Security:</strong> JWT tokens, RBAC</li>
                    </ul>
                </div>

                <div class="component-card api">
                    <div class="component-title">üí¨ Chat Endpoints</div>
                    <div class="component-description">Conversational AI interface</div>
                    <ul class="file-list">
                        <li><strong>POST /chat/completions:</strong> Chat completion</li>
                        <li><strong>GET /chat/history:</strong> Conversation history</li>
                        <li><strong>Features:</strong> PII filtering, RAG integration</li>
                    </ul>
                </div>

                <div class="component-card api">
                    <div class="component-title">ü§ñ Completion Endpoints</div>
                    <div class="component-description">Text generation and completion</div>
                    <ul class="file-list">
                        <li><strong>POST /completions:</strong> Text completion</li>
                        <li><strong>POST /completions/stream:</strong> Streaming completion</li>
                        <li><strong>Features:</strong> Multiple models, streaming</li>
                    </ul>
                </div>

                <div class="component-card api">
                    <div class="component-title">üìÑ Document Endpoints</div>
                    <div class="component-description">Document management and processing</div>
                    <ul class="file-list">
                        <li><strong>POST /documents/upload:</strong> Document upload</li>
                        <li><strong>GET /documents:</strong> List documents</li>
                        <li><strong>DELETE /documents/{id}:</strong> Delete document</li>
                        <li><strong>Features:</strong> Multi-format support, metadata</li>
                    </ul>
                </div>

                <div class="component-card api">
                    <div class="component-title">üîç Retrieval Endpoints</div>
                    <div class="component-description">Vector search and retrieval</div>
                    <ul class="file-list">
                        <li><strong>POST /retrieval/search:</strong> Semantic search</li>
                        <li><strong>POST /retrieval/similarity:</strong> Similarity search</li>
                        <li><strong>Features:</strong> Vector search, filtering</li>
                    </ul>
                </div>

                <div class="component-card api">
                    <div class="component-title">üõ°Ô∏è Moderation Endpoints</div>
                    <div class="component-description">Content filtering and PII detection</div>
                    <ul class="file-list">
                        <li><strong>POST /moderation/screen:</strong> Fast PII screening</li>
                        <li><strong>POST /moderation/analyze:</strong> Comprehensive analysis</li>
                        <li><strong>Features:</strong> Two-tier architecture, PIPEDA compliance</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Maintenance Section -->
        <div id="maintenance" class="content-section">
            <div class="breadcrumb">
                <a href="#overview">Home</a> > Maintenance Guides
            </div>
            
            <h2>üîß Maintenance Guides</h2>
            <p>Visual step-by-step guides for common maintenance tasks.</p>

            <div class="component-grid">
                <div class="component-card pii">
                    <div class="component-title">üîç Adding New PII Patterns</div>
                    <div class="component-description">Step-by-step guide for adding new PII detection patterns</div>
                    <div class="diagram-container">
                        <div class="mermaid">
                            flowchart TD
                                Start[New PII Pattern Request] --> Identify[Identify Pattern Type]
                                Identify --> Canadian{Canadian Specific?}
                                Canadian -->|Yes| AddPattern[Add to ircc_patterns dict<br/>fast_pii_screener.py]
                                Canadian -->|No| AddGeneric[Add to generic patterns<br/>enhanced_content_filter.py]
                                AddPattern --> Validator[Create validation function]
                                Validator --> Test[Add unit tests<br/>test_enhanced_pii_filtering.py]
                                Test --> Deploy[Deploy to staging]
                                Deploy --> Monitor[Monitor detection rates]
                                
                                style Start fill:#e1f5fe
                                style Deploy fill:#fff3e0
                                style Monitor fill:#f3e5f5
                        </div>
                    </div>
                </div>

                <div class="component-card rag">
                    <div class="component-title">üìà Scaling Vector Database</div>
                    <div class="component-description">Performance optimization for vector databases</div>
                    <div class="diagram-container">
                        <div class="mermaid">
                            flowchart TD
                                Alert[High Vector DB Latency] --> Check[Check Current Load<br/>GET /monitoring/performance]
                                Check --> Pinecone{Using Pinecone?}
                                Pinecone -->|Yes| ScalePods[Scale Pinecone Pods<br/>Update pod type/replicas]
                                Pinecone -->|No| ScaleWeaviate[Scale Weaviate Cluster<br/>Add nodes/increase resources]
                                ScalePods --> UpdateConfig[Update VECTOR_DB_URI<br/>config.py]
                                ScaleWeaviate --> UpdateConfig
                                UpdateConfig --> TestConnection[Test Connection<br/>vector_db_service.py]
                                TestConnection --> Monitor[Monitor Performance<br/>Check metrics]
                                
                                style Alert fill:#ffebee
                                style UpdateConfig fill:#e8f5e8
                                style Monitor fill:#e1f5fe
                        </div>
                    </div>
                </div>

                <div class="component-card database">
                    <div class="component-title">üêõ Debugging PII False Positives</div>
                    <div class="component-description">Troubleshooting PII detection issues</div>
                    <div class="diagram-container">
                        <div class="mermaid">
                            flowchart TD
                                Report[False Positive Report] --> Logs[Check Audit Logs<br/>GET /monitoring/pii/stats]
                                Logs --> Pattern[Identify Triggering Pattern]
                                Pattern --> FastTier{Fast Tier or Background?}
                                FastTier -->|Fast| UpdateScreener[Update FastPIIScreener<br/>Adjust patterns/thresholds]
                                FastTier -->|Background| UpdateFilter[Update EnterpriseContentFilter<br/>Retrain ML models]
                                UpdateScreener --> TestPattern[Test Pattern Changes<br/>Unit tests + staging]
                                UpdateFilter --> TestPattern
                                TestPattern --> Deploy[Deploy Fix<br/>Rolling deployment]
                                Deploy --> Validate[Validate with Original Case<br/>Regression testing]
                                
                                style Report fill:#fff3e0
                                style TestPattern fill:#e8f5e8
                                style Validate fill:#e1f5fe
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Onboarding Section -->
        <div id="onboarding" class="content-section">
            <div class="breadcrumb">
                <a href="#overview">Home</a> > Onboarding Flows
            </div>
            
            <h2>üéì Developer Onboarding</h2>
            <p>Progressive learning paths for different developer roles.</p>

            <div class="component-grid">
                <div class="component-card auth">
                    <div class="component-title">üñ•Ô∏è Backend Developer Path</div>
                    <div class="component-description">4-week onboarding for backend developers</div>
                    <div class="diagram-container">
                        <div class="mermaid">
                            journey
                                title Backend Developer Onboarding
                                section Week 1: Foundation
                                  Read Architecture Docs: 5: Developer
                                  Explore app/main.py: 4: Developer
                                  Understand FastAPI Structure: 4: Developer
                                  Set up Development Environment: 3: Developer
                                section Week 2: PII Deep Dive
                                  Study FastPIIScreener: 4: Developer
                                  Understand BackgroundProcessor: 3: Developer
                                  Review HybridOrchestrator: 4: Developer
                                  Implement PII Pattern: 5: Developer
                                section Week 3: RAG Pipeline
                                  Explore VectorDBService: 4: Developer
                                  Study EmbeddingService: 3: Developer
                                  Review AttributionService: 4: Developer
                                  Build RAG Feature: 5: Developer
                                section Week 4: Integration
                                  Performance Optimization: 4: Developer
                                  Testing Patterns: 4: Developer
                                  First Major Contribution: 5: Developer
                        </div>
                    </div>
                    <ul class="file-list">
                        <li><strong>Week 1 Files:</strong> app/main.py, app/core/config.py, app/api/v1/router.py</li>
                        <li><strong>Week 2 Files:</strong> app/services/pii/, app/services/hybrid_orchestrator.py</li>
                        <li><strong>Week 3 Files:</strong> app/services/retrieval/, app/services/embeddings/</li>
                        <li><strong>Week 4 Files:</strong> tests/, docs/, performance optimization</li>
                    </ul>
                </div>

                <div class="component-card rag">
                    <div class="component-title">üé® Frontend Developer Path</div>
                    <div class="component-description">4-week onboarding for frontend developers</div>
                    <div class="diagram-container">
                        <div class="mermaid">
                            journey
                                title Frontend Developer Onboarding
                                section Week 1: Next.js Foundation
                                  Next.js App Structure: 5: Developer
                                  React Components: 4: Developer
                                  API Integration Patterns: 4: Developer
                                  Authentication Flow: 3: Developer
                                section Week 2: Component Architecture
                                  Chat Components: 4: Developer
                                  Document Components: 3: Developer
                                  State Management: 4: Developer
                                  UI/UX Patterns: 5: Developer
                                section Week 3: AI Integration
                                  Real-time Chat: 4: Developer
                                  Document Upload: 3: Developer
                                  Error Handling: 4: Developer
                                  Performance Optimization: 5: Developer
                                section Week 4: Advanced Features
                                  Testing Components: 4: Developer
                                  Accessibility: 4: Developer
                                  First Feature Implementation: 5: Developer
                        </div>
                    </div>
                    <ul class="file-list">
                        <li><strong>Week 1 Files:</strong> Next.js app/, components/layout/, lib/api/</li>
                        <li><strong>Week 2 Files:</strong> components/chat/, components/documents/, context/</li>
                        <li><strong>Week 3 Files:</strong> hooks/, lib/utils/, error handling</li>
                        <li><strong>Week 4 Files:</strong> tests/, accessibility, performance</li>
                    </ul>
                </div>

                <div class="component-card config">
                    <div class="component-title">üöÄ DevOps/Platform Path</div>
                    <div class="component-description">4-week onboarding for platform engineers</div>
                    <div class="diagram-container">
                        <div class="mermaid">
                            journey
                                title DevOps/Platform Engineer Onboarding
                                section Week 1: Infrastructure
                                  Docker Setup: 5: Engineer
                                  Database Configuration: 4: Engineer
                                  Environment Management: 4: Engineer
                                  Security Configuration: 3: Engineer
                                section Week 2: Deployment
                                  CI/CD Pipelines: 4: Engineer
                                  Monitoring Setup: 3: Engineer
                                  Logging Configuration: 4: Engineer
                                  Performance Monitoring: 5: Engineer
                                section Week 3: Scaling
                                  Load Balancing: 4: Engineer
                                  Database Scaling: 3: Engineer
                                  Vector DB Optimization: 4: Engineer
                                  Caching Strategies: 5: Engineer
                                section Week 4: Operations
                                  Incident Response: 4: Engineer
                                  Backup Strategies: 4: Engineer
                                  First Infrastructure Improvement: 5: Engineer
                        </div>
                    </div>
                    <ul class="file-list">
                        <li><strong>Week 1 Files:</strong> docker-compose.yml, Dockerfile, .env.example</li>
                        <li><strong>Week 2 Files:</strong> CI/CD configs, monitoring setup, logging</li>
                        <li><strong>Week 3 Files:</strong> scaling configs, performance tuning</li>
                        <li><strong>Week 4 Files:</strong> operational procedures, automation</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif'
        });

        // Navigation functions
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Update nav tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Layer navigation for architecture section
        function showLayer(layerId) {
            // Hide all layer containers in architecture section
            const layerContainers = ['layer1', 'layer2', 'layer3', 'layer4'];
            layerContainers.forEach(containerId => {
                const container = document.getElementById(containerId);
                if (container) {
                    container.style.display = 'none';
                }
            });
            
            // Show selected layer
            const selectedLayer = document.getElementById(layerId);
            if (selectedLayer) {
                selectedLayer.style.display = 'block';
                
                // Force Mermaid to render diagrams in the newly visible layer
                const mermaidElements = selectedLayer.querySelectorAll('.mermaid');
                mermaidElements.forEach((element, index) => {
                    // Only process if not already rendered
                    if (!element.getAttribute('data-processed')) {
                        const uniqueId = `mermaid-${layerId}-${index}`;
                        element.id = uniqueId;
                        
                        // Get the diagram definition
                        const diagramDef = element.textContent.trim();
                        
                        // Clear the element and render
                        element.innerHTML = '';
                        mermaid.render(uniqueId + '-svg', diagramDef, (svgCode) => {
                            element.innerHTML = svgCode;
                            element.setAttribute('data-processed', 'true');
                        });
                    }
                });
            }
            
            // Update layer buttons
            const buttons = document.querySelectorAll('.layer-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Toggle component details
        function toggleDetails(card) {
            const details = card.querySelector('.component-details');
            if (details) {
                details.classList.toggle('expanded');
            }
        }

        // Show file details (placeholder function)
        function showFileDetails(filePath) {
            alert(`File Details: ${filePath}\n\nThis would show detailed information about the file, including:\n- Function definitions\n- Dependencies\n- Recent changes\n- Performance metrics`);
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const cards = document.querySelectorAll('.component-card');
            
            cards.forEach(card => {
                const title = card.querySelector('.component-title').textContent.toLowerCase();
                const description = card.querySelector('.component-description').textContent.toLowerCase();
                const fileList = card.querySelector('.file-list');
                const files = fileList ? fileList.textContent.toLowerCase() : '';
                
                if (title.includes(searchTerm) || description.includes(searchTerm) || files.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // Initialize tooltips and interactive elements
        document.addEventListener('DOMContentLoaded', function() {
            // Add click handlers for file links
            const fileLinks = document.querySelectorAll('.file-list li');
            fileLinks.forEach(link => {
                link.addEventListener('click', function() {
                    const fileName = this.textContent.split(' - ')[0];
                    showFileDetails(fileName);
                });
            });
            
            // Initialize component cards
            const componentCards = document.querySelectorAll('.component-card');
            componentCards.forEach(card => {
                card.addEventListener('click', function() {
                    toggleDetails(this);
                });
            });
        });
    </script>
</body>
</html>
