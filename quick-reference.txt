================================================================================
ğŸš€ FastAPI + Next.js AI Platform - Quick Reference
================================================================================

ğŸ“Š SYSTEM OVERVIEW
================================================================================
Enterprise AI Platform for Canadian Organizations
- Two-Tier PII Detection (0-5ms + comprehensive)
- RAG Pipeline with Vector Databases
- PIPEDA Compliance Built-in
- 47 Services | 12 API Endpoints | 6 Database Models

ğŸ—ï¸ ARCHITECTURE LAYERS
================================================================================

Layer 1: Executive Overview
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Users  â”‚â”€â”€â”€â–¶â”‚ Frontend â”‚â”€â”€â”€â–¶â”‚   API   â”‚â”€â”€â”€â–¶â”‚ AI Svcs  â”‚â”€â”€â”€â–¶â”‚   Data   â”‚
â”‚   ğŸ‘¥    â”‚    â”‚   ğŸ–¥ï¸     â”‚    â”‚   ğŸš€    â”‚    â”‚    ğŸ§     â”‚    â”‚   ğŸ—„ï¸    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                     â”‚
                                                     â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚ External â”‚
                                              â”‚    ğŸŒ    â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 2: Service Architecture
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend Svcs  â”‚    â”‚  Backend Svcs   â”‚    â”‚  AI Processing  â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ Next.js App   â”‚â”€â”€â”€â–¶â”‚ â€¢ FastAPI       â”‚â”€â”€â”€â–¶â”‚ â€¢ Orchestrator  â”‚
â”‚ â€¢ Components    â”‚    â”‚ â€¢ API Router    â”‚    â”‚ â€¢ FastPII       â”‚
â”‚ â€¢ API Client    â”‚    â”‚ â€¢ Middleware    â”‚    â”‚ â€¢ BackgroundPII â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ RAG Service   â”‚
                                              â”‚ â€¢ Model Router  â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚  Data Services  â”‚
                                              â”‚                 â”‚
                                              â”‚ â€¢ PostgreSQL    â”‚
                                              â”‚ â€¢ Vector DB     â”‚
                                              â”‚ â€¢ Redis Cache   â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”’ PII DETECTION - TWO-TIER ARCHITECTURE
================================================================================

User Input
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastPIIScreener â”‚ â—„â”€â”€â”€ Tier 1: 0-5ms Critical Blocking
â”‚   (Tier 1)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â–¼           â–¼
Critical?   Background
    â”‚       Processor
    â–¼       (Tier 2)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ BLOCK   â”‚      â–¼
â”‚ Request â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ ML Analysis â”‚
             â”‚ Compliance  â”‚
             â”‚ Audit Log   â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Tier 1 Features:
â€¢ Pattern Matching (SIN, UCI, IRCC)
â€¢ Circuit Breaker Protection
â€¢ Redis Cache Optimization
â€¢ Real-time Tokenization

Tier 2 Features:
â€¢ Advanced ML Detection
â€¢ PIPEDA Compliance
â€¢ Complete Audit Trail
â€¢ Async Queue Management

ğŸ§  RAG PIPELINE
================================================================================

Document Upload â”€â”€â–¶ Text Chunking â”€â”€â–¶ Generate Embeddings â”€â”€â–¶ Vector Storage
                                                                      â”‚
User Query â”€â”€â–¶ Query Embedding â”€â”€â–¶ Semantic Search â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                                  Retrieve Top-K â”€â”€â–¶ Build Context â”€â”€â–¶ LLM
                                                                        â”‚
                                                                        â–¼
                                  Final Response â—„â”€â”€ Add Citations â—„â”€â”€â”€â”˜

Components:
â€¢ Document Processing: PDF, DOCX, TXT, HTML
â€¢ Embedding Service: OpenAI text-embedding-ada-002
â€¢ Vector Database: Pinecone (managed) / Weaviate (open-source)
â€¢ Attribution Service: Automatic citations & source tracking

ğŸ—„ï¸ DATABASE SCHEMA
================================================================================

Document â”€â”€â”¬â”€â”€ DocumentChunk â”€â”€â”€â”€ Embedding
           â”‚
           â””â”€â”€ (metadata, security, versioning)

User â”€â”€â”€â”€ Conversation â”€â”€â”€â”€ Message
     â”‚
     â””â”€â”€ (auth, roles, permissions)

Implementation Status:
âœ… Document, DocumentChunk, Embedding
âŒ User, Conversation, Message (Missing)

ğŸŒ API ENDPOINTS
================================================================================

/api/v1/
â”œâ”€â”€ auth/           ğŸ” Authentication (login, refresh, logout)
â”œâ”€â”€ chat/           ğŸ’¬ Chat completions, history
â”œâ”€â”€ completions/    ğŸ¤– Text generation, streaming
â”œâ”€â”€ documents/      ğŸ“„ Upload, list, delete
â”œâ”€â”€ retrieval/      ğŸ” Semantic search, similarity
â”œâ”€â”€ moderation/     ğŸ›¡ï¸ PII screening, analysis
â”œâ”€â”€ models/         ğŸ§  Model info, capabilities
â”œâ”€â”€ users/          ğŸ‘¤ User management
â””â”€â”€ monitoring/     ğŸ“Š PII stats, performance

âš™ï¸ CORE SERVICES
================================================================================

PII Services:
â€¢ FastPIIScreener      - Immediate blocking (0-5ms)
â€¢ BackgroundProcessor  - Comprehensive analysis
â€¢ EnterpriseFilter     - ML-based detection

RAG Services:
â€¢ VectorDBService      - Pinecone/Weaviate integration
â€¢ EmbeddingService     - OpenAI embeddings
â€¢ AttributionService   - Citation generation
â€¢ DocumentProcessor    - Text chunking

LLM Services:
â€¢ OpenAIService        - GPT models
â€¢ AnthropicService     - Claude models
â€¢ OnPremService        - Local models
â€¢ ModelRouter          - Request routing

Data Services:
â€¢ SessionManager       - Database connections
â€¢ Repositories         - Data access layer
â€¢ Models              - SQLAlchemy entities
â€¢ Schemas             - Pydantic validation

ğŸ”§ MAINTENANCE QUICK GUIDES
================================================================================

Adding PII Patterns:
1. Identify pattern type (Canadian vs Generic)
2. Add to fast_pii_screener.py or enhanced_content_filter.py
3. Create validation function
4. Add unit tests
5. Deploy to staging
6. Monitor detection rates

Scaling Vector DB:
1. Check current load (GET /monitoring/performance)
2. Scale Pinecone pods OR Weaviate cluster
3. Update VECTOR_DB_URI in config.py
4. Test connection
5. Monitor performance

Debugging PII False Positives:
1. Check audit logs (GET /monitoring/pii/stats)
2. Identify triggering pattern
3. Update FastPIIScreener OR EnterpriseContentFilter
4. Test pattern changes
5. Deploy fix
6. Validate with original case

ğŸ“ DEVELOPER ONBOARDING PATHS
================================================================================

Backend Developer (4 weeks):
Week 1: Foundation (main.py, config.py, router.py)
Week 2: PII Deep Dive (pii/, hybrid_orchestrator.py)
Week 3: RAG Pipeline (retrieval/, embeddings/)
Week 4: Integration (tests/, docs/, optimization)

Frontend Developer (4 weeks):
Week 1: Next.js Foundation (app/, components/layout/, lib/api/)
Week 2: Component Architecture (chat/, documents/, context/)
Week 3: AI Integration (hooks/, utils/, error handling)
Week 4: Advanced Features (tests, accessibility, performance)

DevOps/Platform (4 weeks):
Week 1: Infrastructure (Docker, DB, environment, security)
Week 2: Deployment (CI/CD, monitoring, logging)
Week 3: Scaling (load balancing, DB scaling, caching)
Week 4: Operations (incident response, backup, automation)

ğŸ“š KEY FILES REFERENCE
================================================================================

Configuration:
â€¢ app/core/config.py           - Main configuration & feature flags
â€¢ .env.example                 - Environment variables template
â€¢ docker-compose.yml           - Container orchestration
â€¢ requirements.txt             - Python dependencies

Core Services:
â€¢ app/services/hybrid_orchestrator.py     - Main orchestration logic
â€¢ app/services/pii/fast_pii_screener.py   - Fast PII detection (Tier 1)
â€¢ app/services/pii/background_processor.py - Comprehensive PII (Tier 2)
â€¢ app/services/retrieval/vector_db_service.py - Vector operations
â€¢ app/services/embeddings/embedding_service.py - Embedding generation

Database:
â€¢ app/db/session.py            - Database session management
â€¢ app/db/base.py               - Base model classes
â€¢ app/models/document.py       - Document & chunk models
â€¢ app/models/embedding.py      - Embedding models

API:
â€¢ app/main.py                  - FastAPI application entry point
â€¢ app/api/v1/router.py         - Main API router
â€¢ app/api/v1/endpoints/        - Individual endpoint implementations

Testing:
â€¢ tests/test_enhanced_pii_filtering.py     - PII detection tests
â€¢ tests/test_pii_middleware_integration.py - Integration tests

ğŸ“ SUPPORT & DOCUMENTATION
================================================================================

Interactive Documentation:
â€¢ architecture-documentation.html - Full interactive experience
â€¢ README-architecture.md          - GitHub-friendly documentation

Additional Resources:
â€¢ docs/ directory                 - Detailed service documentation
â€¢ Code comments & docstrings      - Implementation details
â€¢ Unit tests                      - Usage examples
â€¢ OpenAPI docs                    - API documentation (/docs endpoint)

Performance Monitoring:
â€¢ GET /monitoring/performance     - System performance metrics
â€¢ GET /monitoring/pii/stats       - PII detection statistics
â€¢ Logs                           - Structured logging with audit trail

================================================================================
ğŸ”— For interactive diagrams and detailed exploration:
   Open architecture-documentation.html in your browser
================================================================================
